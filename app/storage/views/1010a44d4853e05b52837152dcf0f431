<?php
$total = 0;
$item_no = 1;
?>
        <!DOCTYPE html>
<html>
<title>Office Order</title>
<head>
    <link href="<?php echo asset('public/assets/css/print.css'); ?>" rel="stylesheet">
    <style>
        html {
            margin-top: 10px;
            margin-right: 50px;
            margin-left: 50px;
            margin-bottom: 50px;
            font-size:x-small;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
        #no-border{
            border-collapse: collapse;
            border: none;
        }
        #border-top{
            border-collapse: collapse;
            border-top: none;
        }
        #border-right{
            border-collapse: collapse;
            border:1px solid #000;
        }
        #border-bottom{
            border-collapse: collapse;
            border-bottom: none;
        }
        #border-bottom-t{
            border-collapse: collapse;
            border-top:1px solid red;
            border-bottom:1px solid red;
        }
        #border-left{
            border-collapse: collapse;
            border:1px solid #000;
        }
        .align{
            text-align: center;
        }
        .align-top{
            vertical-align : top;
        }
        .table1 {
            width: 100%;
            padding-left: 10px;
        }
        .table1 td {
            border:1px solid #000;
        }
        #padding-bottom {
            padding-bottom: 5px;
        }
        .footer {
            width: 100%;
            text-align: center;
            position: fixed;
        }
        .footer {
            bottom: 35px;
        }
        .pagenum:before {
            content: counter(page);
        }
        .pagenum:before {
            content: counter(page);
        }
        .new-times-roman{
            font-family: "Times New Roman", Times, serif;
            font-size: 11.5pt;
        }
    </style>
</head>
<div class="footer">
    <hr>
    <div style="position:absolute; left: 25%;" class="align">
        <?php echo DNS1D::getBarcodeHTML(Session::get('route_no'),"C39E",1,28) ?>
        <font class="route_no"><?php echo Session::get('route_no'); ?></font>
    </div>
    <div style="position:absolute;margin-top: 33px;" class="align">
        <i style="font-size: 6pt;">
            <?php
                $preparedDivision = pdoController::search_division(pdoController::user_search($office_order->prepared_by)['division'])['id'];
                if( isset($preparedDivision) ) {
                    if($preparedDivision == 3){
                        $preparedDivision = 'RD / ARD';
                    }
                    elseif($preparedDivision == 4){
                        $preparedDivision = 'LHSD';
                    }
                    elseif($preparedDivision == 5){
                        $preparedDivision = 'RLED';
                    }
                    elseif($preparedDivision == 6){
                        $preparedDivision = 'MSD';
                    }
                    else{
                        $preparedDivision = 'NoDivision';
                    }
                }
                else {
                    $preparedDivision = 'NoDivision';
                }

                $preparedSection = pdoController::search_section(pdoController::user_search($office_order->prepared_by)['section'])['description'];
                $preparedName = InformationPersonal::where('userid','=',$office_order->prepared_by)->first()->lname;
                echo $preparedDivision.'/'.$preparedSection.'/'.str_replace('\' ', '\'', ucwords(str_replace('\'', '\' ', strtolower($preparedName))));
            ?>
        </i>
    </div>
</div>
<body>
<div class="new-times-roman" style="margin-bottom: 25px;">
    <div style="position:absolute;margin-left: 182px;margin-top: 208px;">
        <b>:</b>
    </div>
    <table class="letter-head" cellpadding="0" cellspacing="0">
        <tr>
            <td id="no-border" class="align"><img src="<?php echo asset('public/img/doh.png'); ?>" width="100"></td>
            <td width="90%" id="no-border">
                <div class="align small-text" style="margin-top:-10px;font-size: 10.5pt">
                    Republic of the Philippines<br>
                    <strong>DEPARTMENT OF HEALTH REGIONAL OFFICE VII</strong><br>
                    Osmeña Boulevard, Cebu City, 6000 Philippines<br>
                    Regional Director’s Office Tel. No. (032) 253-6355 Fax No. (032) 254-0109<br>
                    Official Website: http://www.ro7.doh.gov.ph Email Address: dohro7@gmail.com<br>
                </div>
            </td>
            <td id="no-border" class="align"><img src="<?php echo asset('public/img/ro7.png'); ?>" width="100"></td>
        </tr>
    </table>
    <hr>
    <table class="letter-head" cellpadding="0" cellspacing="0">
        <tr>
            <td colspan="4" id="no-border">
                <?php
                    $monthA=array(array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
                    ,array("January","Febuary","March","April","May","June","July","August","September","October","November","December"));
                    $m=date('M',strtotime($office_order->prepared_date));
                    for($i=0;$i<count($monthA[0]);$i++){
                        if($m==$monthA[0][$i]){
                            $pos=$i;
                            break;
                        }
                    }
                    echo str_replace( $m,$monthA[1][$pos],date('d M Y',strtotime($office_order->prepared_date)) );
                ?>
            </td>
        </tr>
        <tr>
            <td colspan="1" id="no-border" width="25%"><b>OFFICE ORDER</b></td>
            <td colspan="3" id="no-border" width="75%">)</td>
        </tr>
        <tr>
            <td colspan="1" id="no-border" width="25%">No.<h2 style="display: inline;"><u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<!-- <?php echo sprintf('%04u',$office_order->id); ?> --></u></h2><?php echo 's., '.date('Y',strtotime($office_order->prepared_date)); ?>&nbsp;&nbsp;<b></b></td>
            <td colspan="3" id="no-border" width="75%">)</td>
        </tr>
        <tr>
            <td colspan="1" id="no-border" class="align-top" width="25%"><b>SUBJECT:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<u></u></td>
            <td colspan="3" id="no-border" width="75%"><u><?php echo $office_order->subject; ?></u></td>
        </tr>
        <tr>
            <td colspan="4" id="no-border"><?php echo nl2br($office_order->header_body); ?></td>
        </tr>
    </table>

    <?php $count = 0; ?>
    <?php foreach( $division as $div ): ?>
        <?php foreach($name as $row): ?>
            <?php if( $div['id'] == $row['division_id'] && !isset($flag[$div['id']]) ): ?>
                <table class="table1" cellpadding="0" cellspacing="0">
                    <tr>
                        <td colspan="3" id="no-border"><b><?php echo $div['description']; ?></b></td>
                    </tr>
                    <tr>
                        <td id="no-border padding-bottom" width="45%">
                            <i>
                                Name
                            </i>
                        </td>
                        <td id="no-border padding-bottom" width="45%">
                            <i>
                                Designation
                            </i>
                        </td>
                        <td id="no-border padding-bottom" width="10%">
                            <i>
                                Job Status
                            </i>
                        </td>
                    </tr>

                    <?php foreach($name as $row): ?>
                        <?php if( $div['id'] == $row['division_id'] ): ?>
                        <?php
                            $count++;
                            isset( $row['fname'] ) ? $fname = $row['fname'] : $fname = 'no fname';
                            $row['mname'] != '' ? $mname = strtoupper($row['mname'][0]) : $mname = '';
                            isset( $row['lname'] ) ? $lname = $row['lname'] : $lname = 'no lname';
                        ?>
                            <tr>
                                <td id="no-border"><?php echo $count.'. '.str_replace('\' ', '\'', ucwords(str_replace('\'', '\' ', strtolower($fname)))).' '.$mname.'. '.str_replace('\' ', '\'', ucwords(str_replace('\'', '\' ', strtolower($lname)))); ?></td>
                                <td id="no-border"><?php if(isset(pdoController::designation_search($row['designation_id'])['description'])): ?> <?php echo pdoController::designation_search($row['designation_id'])['description']; ?> <?php endif; ?></td>
                                <td id="no-border"><?php echo $row['job_status']; ?></td>
                            </tr>
                        <?php endif; ?>
                    <?php endforeach; ?>
                    <?php if( $row['division_id'] == 6 ): ?>
                        <?php for( $i = 0; $i < $office_order->driver; $i++ ): ?>
                            <?php $count++; ?>
                            <tr>
                                <td id="no-border"><?php echo $count; ?>.<b>____________________</b></td>
                                <td id="no-border">Driver</td>
                                <td id="no-border">Job Order</td>
                            </tr>
                        <?php endfor; ?>
                    <?php else: ?>
                        <?php $driverFlag = true; ?>
                    <?php endif; ?>
                </table>
                <br>
                <?php $flag[$div['id']] = true; ?>
            <?php endif; ?>
        <?php endforeach; ?>
    <?php endforeach; ?>

    <?php if( $office_order->driver > 0 and isset($driverFlag) ): ?>
        <table class="table1" cellpadding="0" cellspacing="0">
            <tr>
                <td colspan="3" id="no-border"><b><?php echo Division::find(6)->description; ?></b></td>
            </tr>
            <tr>
                <td id="no-border padding-bottom" width="45%">
                    <i>
                        Name
                    </i>
                </td>
                <td id="no-border padding-bottom" width="45%">
                    <i>
                        Designation
                    </i>
                </td>
                <td id="no-border padding-bottom" width="10%">
                    <i>
                        Job Status
                    </i>
                </td>
            </tr>
            <?php for( $i = 0; $i < $office_order->driver; $i++ ): ?>
                <?php $count++; ?>
                <tr>
                    <td id="no-border"><?php echo $count; ?>.<b>____________________</b></td>
                    <td id="no-border">Driver</td>
                    <td id="no-border">Job Order</td>
                </tr>
            <?php endfor; ?>
        </table>
    <?php endif; ?>

    <?php foreach($name as $row): ?>
        <?php if( $row['division_id'] == '' ): ?>
            <table class="table1" cellpadding="0" cellspacing="0">
                <tr>
                    <td colspan="3" id="no-border"><b>NO DIVISION</b></td>
                </tr>
                <tr>
                    <td id="no-border padding-bottom" width="45%">
                        <i>
                            Name
                        </i>
                    </td>
                    <td id="no-border padding-bottom" width="45%">
                        <i>
                            Designation
                        </i>
                    </td>
                    <td id="no-border padding-bottom" width="10%">
                        <i>
                            Job Status
                        </i>
                    </td>
                </tr>

                <?php foreach($name as $row): ?>
                    <?php if( $row['division_id'] == '' ): ?>
                        <?php
                        $count++;
                        isset( $row['fname'] ) ? $fname = $row['fname'] : $fname = 'no fname';
                        $row['mname'] != '' ? $mname = strtoupper($row['mname'][0]) : $mname = '';
                        isset( $row['lname'] ) ? $lname = $row['lname'] : $lname = 'no lname';
                        ?>
                        <tr>
                            <td id="no-border"><?php echo $count.'. '.str_replace('\' ', '\'', ucwords(str_replace('\'', '\' ', strtolower($fname)))).' '.$mname.'. '.str_replace('\' ', '\'', ucwords(str_replace('\'', '\' ', strtolower($lname)))); ?></td>
                            <td id="no-border"><?php if(isset(pdoController::designation_search($row['designation_id'])['description'])): ?> <?php echo pdoController::designation_search($row['designation_id'])['description']; ?> <?php endif; ?></td>
                            <td id="no-border"><?php echo $row['job_status']; ?></td>
                        </tr>
                    <?php endif; ?>
                <?php endforeach; ?>
            </table>
            <?php break; ?>
        <?php endif; ?>
    <?php endforeach; ?>

    <table class="letter-head" cellpadding="0" cellspacing="0">
        <tr>
            <td colspan="3" id="no-border"><?php echo nl2br($office_order->footer_body); ?></td>
        </tr>
        <tr>
            <td id="no-border"></td>
        </tr>
        <tr>
            <td colspan="3" id="no-border">
                <b>
                    <!-- <?php echo $office_order->approved_by; ?> -->
                    Sophia M. Mancao, MD, DPSP
                </b><br>
                OIC, Director III
                <!-- <?php if($office_order->approved_by == 'Jaime S. Bernadas, MD, MGM, CESO III'): ?>
                    Director IV
                <?php elseif($office_order->approved_by == 'Sophia M. Mancao, MD, DPSP'): ?>
                    OIC - Director III
                <?php else: ?>
                    Director III
                <?php endif; ?> -->
            </td>
        </tr>
    </table>
</div>
</body>
</html>