<?php $__env->startSection('content'); ?>
    <style>
        u{
            color: #307bff;
        }
    </style>
    <div class="col-md-12 wrapper">
        <div class="alert alert-jim">
            <div class="row">
                <div class="col-md-12">
                    <form class="form-inline" autocomplete="off" method="POST" action="<?php echo asset('logs/timelog'); ?>" id="submit_logs" style="margin-right: 2%">
                        <input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
                        <input type="text" class="form-control filter_dates" value="<?php echo Session::get('filter_dates'); ?>" id="inclusive3" name="filter_dates" placeholder="Filter Date" required>
                        <button type="submit" class="btn btn-success" id="print">
                            Go
                        </button>
                    </form>
                    <br>
                    <?php if(empty($timeLog)): ?>
                        <div class="alert alert-info">
                            <p style="color: #1387ff">
                                No logs record
                            </p>
                        </div>
                    <?php else: ?>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <?php
                                    $from = explode('-',Session::get('filter_dates'))[0];
                                    $to = explode('-',Session::get('filter_dates'))[1];
                                ?>
                                <strong style="color: #f01786;font-size:medium;">Manage Time Log <?php echo ' - '.date('F d,Y',strtotime($from)).' to '.date('F d,Y',strtotime($to)); ?></strong>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <tr>
                                                <th width="10%">Date In</th>
                                                <th width="12%">AM IN</th>
                                                <th width="12%">AM OUT</th>
                                                <th width="12%">PM IN</th>
                                                <th width="15%">PM OUT</th>
                                            </tr>
                                            <tbody class="timelog">
                                            <?php $count = 0; ?>
                                            <?php foreach($timeLog as $row): ?>
                                            <?php $count++; ?>
                                            <tr>
                                                <td ><?php echo $row->datein; ?></td>
                                                <td>
                                                    <input type="hidden" value="<?php echo explode("_",explode('|',$row->time)[0])[2]; ?>" id="<?php echo $count."ñ"."AM_IN"; ?>">
                                                    <?php if(empty(explode("_",explode('|',$row->time)[0])[1])): ?>
                                                        <b><u><span><?php echo explode("_",explode('|',$row->time)[0])[0]; ?></span></u></b>
                                                    <?php else: ?>
                                                        <span style="cursor: pointer;" class="editable" id="<?php echo
                                                            Auth::user()->userid.'ñ'.
                                                            $row->datein.'ñ'.
                                                            str_replace(':','-',explode("_",explode('|',$row->time)[0])[2]).
                                                            'ñ'.explode("_",explode('|',$row->time)[0])[3].'ñ'.
                                                            "AM_IN"."ñ".
                                                            $count;
                                                        ?>"><?php echo explode("_",explode('|',$row->time)[0])[0]; ?></span>
                                                    <?php endif; ?>
                                                </td>
                                                <td>
                                                    <input type="hidden" value="<?php echo explode("_",explode('|',$row->time)[1])[2]; ?>" id="<?php echo $count."ñ"."AM_OUT"; ?>">
                                                    <?php if(empty(explode("_",explode('|',$row->time)[1])[1])): ?>
                                                        <b><u><span><?php echo explode("_",explode('|',$row->time)[1])[0]; ?></span></u></b>
                                                    <?php else: ?>
                                                        <span style="cursor: pointer;" class="editable" id="<?php echo
                                                            Auth::user()->userid.'ñ'.
                                                            $row->datein.'ñ'.
                                                            str_replace(':','-',explode("_",explode('|',$row->time)[1])[2]).
                                                            'ñ'.explode("_",explode('|',$row->time)[1])[3].'ñ'.
                                                            "AM_OUT"."ñ".
                                                            $count;
                                                        ?>"><?php echo explode("_",explode('|',$row->time)[1])[0]; ?></span>
                                                    <?php endif; ?>
                                                </td>
                                                <td>
                                                    <input type="hidden" value="<?php echo explode("_",explode('|',$row->time)[2])[2]; ?>" id="<?php echo $count."ñ"."PM_IN"; ?>">
                                                    <?php if(empty(explode("_",explode('|',$row->time)[2])[1])): ?>
                                                        <b><u><span><?php echo explode("_",explode('|',$row->time)[2])[0]; ?></span></u></b>
                                                    <?php else: ?>
                                                        <span style="cursor: pointer;" class="editable" id="<?php echo
                                                            Auth::user()->userid.'ñ'.
                                                            $row->datein.'ñ'.
                                                            str_replace(':','-',explode("_",explode('|',$row->time)[2])[2]).
                                                            'ñ'.explode("_",explode('|',$row->time)[2])[3].'ñ'.
                                                            "PM_IN"."ñ".
                                                            $count;
                                                        ?>"><?php echo explode("_",explode('|',$row->time)[2])[0]; ?></span>
                                                    <?php endif; ?>
                                                </td>
                                                <td>
                                                    <input type="hidden" value="<?php echo explode("_",explode('|',$row->time)[3])[2]; ?>" id="<?php echo $count."ñ"."PM_OUT"; ?>">
                                                    <?php if(empty(explode("_",explode('|',$row->time)[3])[1])): ?>
                                                        <b><u><span><?php echo explode("_",explode('|',$row->time)[3])[0]; ?></span></u></b>
                                                    <?php else: ?>
                                                        <span style="cursor: pointer;" class="editable" id="<?php echo
                                                            Auth::user()->userid.'ñ'.
                                                            $row->datein.'ñ'.
                                                            str_replace(':','-',explode("_",explode('|',$row->time)[3])[2]).
                                                            'ñ'.explode("_",explode('|',$row->time)[3])[3].'ñ'.
                                                            "PM_OUT"."ñ".
                                                            $count;
                                                        ?>"><?php echo explode("_",explode('|',$row->time)[3])[0]; ?></span>
                                                    <?php endif; ?>
                                                </td>
                                            </tr>
                                            <?php endforeach; ?>
                                            </tbody>
                                        </table>
                                    </div>
                                    <form action="<?php echo asset('FPDF/timelog/print_individual1.php'); ?>" target="_blank" method="POST">
                                        <div style="padding: 1%;margin-top: -2%;float: right">
                                            <button class="btn btn-success" name="filter_range" value="<?php echo Session::get('filter_dates'); ?>"><i class="fa fa-print"></i> Generate PDF</button>
                                        </div>
                                        <input type="hidden" name="userid" value="<?php echo Auth::user()->userid; ?>">
                                    </form>
                                </div>
                            </div>
                        </div>
                    <?php endif; ?>
                </div>
            </div>
        </div>
    </div>

<?php $__env->stopSection(); ?>

<?php $__env->startSection('js'); ?>
    @parent
    <script>
        $('#inclusive3').daterangepicker();
        $('#submit_logs').submit(function(){
            $('#print_individual').modal({
                backdrop: 'static',
                keyboard: false,
                show: true
            });
        });

        $.fn.editable.defaults.mode = 'inline';

        $(function(){
            $(".editable").each(function(){
                $('#'+this.id).editable({
                    type: 'radiolist',
                    value: '',
                    source: [
                        {value: 1, text: ''},
                    ],
                    validate: function(value) {
                        var edited_display,timelog,office_order,leave,userid,datein,time,log_type,log_status,log_status_change,url,json;

                        timelog = $("#"+this.id+"time_log").val();
                        office_order = $("#"+this.id+"office_order").val();
                        leave = $("#"+this.id+"leave").val();

                        userid = this.id.split("ñ")[0];
                        datein = this.id.split("ñ")[1];
                        time = this.id.split("ñ")[2];
                        log_status = this.id.split("ñ")[3];
                        log_type = this.id.split("ñ")[4];
                        if(timelog){
                            log_status_change = "edited";
                            edited_display = timelog+":00";
                        }
                        else if(office_order){
                            log_status_change = "so";
                            edited_display = "SO#"+office_order
                        }
                        else if($("#"+this.id+"cdo").is(':checked')){
                            log_status_change = "cdo";
                            edited_display = "CDO";
                        }
                        else if(leave){
                            log_status_change = "leave";
                            edited_display = leave;
                        }
                        json = {
                            "userid":userid,
                            "datein":datein,
                            "time":time,
                            "edited_display":edited_display,
                            "log_status":log_status,
                            "log_status_change": log_status_change,
                            "log_type":log_type
                        };

                        var url = "<?php echo asset('logs/timelog/edit'); ?>";
                        var input_hidden_element = $("#"+this.id.split("ñ")[5]+"ñ"+log_type);
                        $.post(url,json,function(result){
                            var input_hidden_time = result.split('-')[1];
                            input_hidden_element.val(input_hidden_time);
                            console.log(result);
                        });
                        $("#"+this.id).html(edited_display);
                    }
                });
            })
        });

        ( function($) {
            var Radiolist = function(options) {
                this.init('radiolist', options, Radiolist.defaults);
            };
            $.fn.editableutils.inherit(Radiolist, $.fn.editabletypes.checklist);

            $.extend(Radiolist.prototype, {
                renderList : function() {
                    var $label;
                    this.$tpl.empty();
                    if (!$.isArray(this.sourceData)) {
                        return;
                    }

                    for (var i = 0; i < this.sourceData.length; i++) {
                        var ID = this.options.scope.id;
                        $label = $('<label>', {'class':this.options.inputclass}).append($('<input>', {
                            type : 'radio',
                            name : this.options.name,
                            value : this.sourceData[i].value
                        })).append($('<span>').text(this.sourceData[i].text));

                    }

                    this.$input = this.$tpl.find('input[type="radio"]');
                    var timelogToAppend = this.$tpl;
                    var am_in,am_out,pm_in,pm_out;
                    //console.log(ID);
                    am_in = $("#"+ID).parent().parent().children('td').children('input').get(0).value;
                    am_out = $("#"+ID).parent().parent().children('td').children('input').get(1).value;
                    pm_in = $("#"+ID).parent().parent().children('td').children('input').get(2).value;
                    pm_out = $("#"+ID).parent().parent().children('td').children('input').get(3).value;
                    console.log($("#"+ID).parent().parent().children('td').children('input').get(0).value);
                    var json = {
                        "elementId" : ID,
                        "am_in" : am_in,
                        "am_out" : am_out,
                        "pm_in" : pm_in,
                        "pm_out" : pm_out
                    };
                    console.log(json);
                    var url = "<?php echo asset('logs/timelog/append') ?>";
                    $.post(url,json,function(result){
                        timelogToAppend.append(result);
                    });
                },
                input2value : function() {
                    return this.$input.filter(':checked').val();
                },
                str2value: function(str) {
                    return str || null;
                },

                value2input: function(value) {
                    this.$input.val([value]);
                },
                value2str: function(value) {
                    return value || '';
                },
            });

            Radiolist.defaults = $.extend({}, $.fn.editabletypes.list.defaults, {
                /**
                 @property  tpl
                 @default  <div></div>
                 **/
                tpl : '<div class="editable-radiolist"></div>',

                /**
                 @property  inputclass, attached to the <label> wrapper instead of the input element
                 @type  string
                 @default  null
                 **/
                inputclass : '',

                name : 'defaultname'
            });

            $.fn.editabletypes.radiolist = Radiolist;
        }(window.jQuery));

    </script>


<?php $__env->stopSection(); ?>
<?php echo $__env->make('layouts.app', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>